<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Markov Chains | Essentials of Mathematics and Statistics</title>
<meta name="author" content="Anas A Rana">
<meta name="description" content="We will now look at a Markov Chain. We have not covered it during lectures but based on the basic principles we have covered we will be able to use it for simulations. Any random process is known...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="Chapter 2 Markov Chains | Essentials of Mathematics and Statistics">
<meta property="og:type" content="book">
<meta property="og:description" content="We will now look at a Markov Chain. We have not covered it during lectures but based on the basic principles we have covered we will be able to use it for simulations. Any random process is known...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Markov Chains | Essentials of Mathematics and Statistics">
<meta name="twitter:description" content="We will now look at a Markov Chain. We have not covered it during lectures but based on the basic principles we have covered we will be able to use it for simulations. Any random process is known...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Manrope-0.4.7/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Fira%20Code:wght@200&amp;display=swap" rel="stylesheet">
<link href="libs/Spectral-0.4.7/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Essentials of Mathematics and Statistics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction to the Practical</a></li>
<li><a class="" href="getting-started-in-r-and-rstudio.html">Getting started in R and Rstudio</a></li>
<li><a class="" href="data-sets.html">Data sets</a></li>
<li><a class="" href="simulating-random-numbers.html"><span class="header-section-number">1</span> Simulating random numbers</a></li>
<li><a class="active" href="markov-chains.html"><span class="header-section-number">2</span> Markov Chains</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/anasrana/ems-practicals">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="markov-chains" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Markov Chains<a class="anchor" aria-label="anchor" href="#markov-chains"><i class="fas fa-link"></i></a>
</h1>
<!-- In this practical you will learn a number of techniques in R that you will use to simulate simplified games of Monopoly (<https://en.wikipedia.org/wiki/Monopoly_(game)>). In addition, there are also many tutorials and guides on the Web describing how to produce computer simulations for Monopoly. You are welcome to read and use these examples to inspire your work. -->
<p>We will now look at a <strong>Markov Chain</strong>. We have not covered it during lectures but based on the basic principles we have covered we will be able to use it for simulations.</p>
<p>Any random process is known to have the <em>Markov property</em> (a Markov process) if the probability of going to the next state depends only on the current state and not on the past states. A Markov process is <strong>memoryless property</strong> in that it does not store any property or memory of its past states.</p>
<p>If a Markov process operates within a specific (finite) set of states, it is called a <strong><em>Markov Chain</em></strong>.</p>
<p>A Markov Chain is defined by three properties:</p>
<ol style="list-style-type: decimal">
<li><p>A state space: a set of values or states in which a process could exist</p></li>
<li><p>A transition matrix: defines the probability of moving from one state to another state</p></li>
<li><p>A current state probability distribution: defines the probability of being in any one of the states at the start of the process</p></li>
</ol>
<p>Consider the following example where we have two states describing the weather on any particular day: (i) Sunny and (ii) Rainy. Each arrow denotes the probability of going from one state to itself or another over the course of a day. For example, if it is currently sunny, the probability of it raining the next day is 0.6. Conversely, if it is raining, the probability that it will become sunny the next day is 0.7 and 0.3 that it will continue raining.</p>
<div class="inline-figure"><img src="04-markov-chains_files/figure-html/unnamed-chunk-1-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>The transition matrix can be written as the following in R:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transitionMatrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.3</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">transitionMatrix</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  0.4  0.6</span></span>
<span><span class="co">#&gt; [2,]  0.7  0.3</span></span></code></pre></div>
<p>which creates a 2 x 2 matrix consisting of the transition probabilities shown in the diagram.</p>
<p>Suppose I want to simulate a sequence of 30 days and the weather patterns over those days. Assuming that on day 0 it is currently sunny, I can do the following:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initial state - it is [1] sunny or [2] rainy</span></span>
<span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">weather_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span> <span class="co"># vector to store simulated values</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">day</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">{</span> <span class="co"># simulate for 30 days</span></span>
<span>  <span class="va">pr</span> <span class="op">&lt;-</span> <span class="va">transitionMatrix</span><span class="op">[</span><span class="va">state</span>, <span class="op">]</span> <span class="co"># select the row of transition probabilities</span></span>
<span></span>
<span>  <span class="co"># sample [1] or [2] based on the probs pr</span></span>
<span>  <span class="va">state</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">pr</span><span class="op">)</span></span>
<span>  <span class="va">weather_sequence</span><span class="op">[</span><span class="va">day</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">state</span> <span class="co"># store the sampled state</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># print the simulated weather sequence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">weather_sequence</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 2 2 1 2 1 2 1 1 1 2 1 2 1 1 1 2 1 2 2 1 1 2 2 1 1 1 1 2</span></span>
<span><span class="co">#&gt; [29] 2 2</span></span></code></pre></div>
<p><strong>Problem</strong></p>
<blockquote>
<p>Can you extend this example to a three-state model?</p>
</blockquote>
<div class="inline-figure"><img src="04-markov-chains_files/figure-html/unnamed-chunk-4-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Note, the diagram (intentionally) misses out the self-transitions. You should be able to infer this because the probabilities given would otherwise not add up to one!</p>
<div id="model-answers-3-state-markov-chain" class="section level2 unnumbered">
<h2>Model answers 3 state Markov Chain<a class="anchor" aria-label="anchor" href="#model-answers-3-state-markov-chain"><i class="fas fa-link"></i></a>
</h2>
<p>Set up a 3x3 transition matrix:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transitionMatrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>,</span>
<span>                            <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>,</span>
<span>                            <span class="fl">0.6</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check matrix set-up correctly</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">transitionMatrix</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]  0.7  0.2  0.1</span></span>
<span><span class="co">#&gt; [2,]  0.3  0.3  0.4</span></span>
<span><span class="co">#&gt; [3,]  0.6  0.2  0.2</span></span></code></pre></div>
<p>Note the ordering of the states is arbitrary but here we have used the convention that State 1 is Sunny, State 2 is Rainy and State 3 is Cloudy which means the probabilities are completed in that order in the transition matrix. We just need to be consistent.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># initial state - it is [1] sunny, [2] rainy and [3] cloudy</span></span>
<span><span class="va">weather_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span> <span class="co"># vector to store simulated values</span></span>
<span></span>
<span><span class="co"># simulate for 30 days</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">day</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pr</span> <span class="op">&lt;-</span> <span class="va">transitionMatrix</span><span class="op">[</span><span class="va">state</span>, <span class="op">]</span> <span class="co"># select the row of transition probabilities</span></span>
<span></span>
<span>  <span class="co"># sample [1-3] based on the probs pr</span></span>
<span>  <span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">pr</span><span class="op">)</span></span>
<span>  <span class="va">weather_sequence</span><span class="op">[</span><span class="va">day</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">state</span> <span class="co"># store the sampled state</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">weather_sequence</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1 2 2 1 1 1 2 3 3 3 3 1 1 3 2 2 1 1 1 1 1 1 1 2 2 3 1 1</span></span>
<span><span class="co">#&gt; [29] 1 1</span></span></code></pre></div>
</div>
<div id="a-monopoly-simulation" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> A Monopoly simulation<a class="anchor" aria-label="anchor" href="#a-monopoly-simulation"><i class="fas fa-link"></i></a>
</h2>
<p>Now you will use to simulate simplified games of Monopoly (<a href="https://en.wikipedia.org/wiki/Monopoly_(game)" class="uri">https://en.wikipedia.org/wiki/Monopoly_(game)</a>). In addition, there are also many tutorials and guides on the Web describing how to produce computer simulations for Monopoly. You are welcome to read and use these examples to inspire your work.</p>
</div>
<div id="moving-around-the-board" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Moving around the board<a class="anchor" aria-label="anchor" href="#moving-around-the-board"><i class="fas fa-link"></i></a>
</h2>
<p>A Monopoly board has 40 spaces. Players take it in turns to roll two dice and traverse around the board according to the sum of the dice values.</p>
<p>Use the following code example to simulate turns of a single player:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_turns</span> <span class="op">&lt;-</span> <span class="fl">100000</span> <span class="co"># number of turns to take</span></span>
<span></span>
<span><span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># start on the GO space</span></span>
<span></span>
<span><span class="va">move_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span><span class="va">positions_visited</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use a for loop to simulate a number of turns</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">turn</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_turns</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># roll two dice</span></span>
<span>  <span class="va">die_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># move player position</span></span>
<span></span>
<span>  <span class="co"># number of positions to move</span></span>
<span>  <span class="va">plus_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">die_values</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># compute new board position</span></span>
<span>  <span class="va">new_board_position</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span> <span class="op">+</span> <span class="va">plus_move</span></span>
<span></span>
<span>  <span class="co"># update board position (this corrects for the fact the board is circular)</span></span>
<span>  <span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">new_board_position</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># store position visited</span></span>
<span>  <span class="va">positions_visited</span><span class="op">[</span><span class="va">turn</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>By increasing the number of turns taken, what distribution does the set of simulated board positions converge towards? Show this graphically using the histogram function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">positions_visited</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, len <span class="op">=</span> <span class="fl">41</span><span class="op">)</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-markov-chains_files/figure-html/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="going-to-jail" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Going to Jail<a class="anchor" aria-label="anchor" href="#going-to-jail"><i class="fas fa-link"></i></a>
</h2>
<p>If a player lands on to Go To Jail space they must move immediately to the Jail space. Extend your code to include the possibility of going to jail. Here, assume that once in jail, the player continues as normal on the next turn.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">num_turns</span> <span class="op">&lt;-</span> <span class="fl">100000</span> <span class="co"># number of turns to take</span></span>
<span></span>
<span><span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># start on the GO space</span></span>
<span><span class="va">go_to_jail_position</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># the go to jail space</span></span>
<span><span class="va">jail_position</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># jail space</span></span>
<span></span>
<span><span class="va">move_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span><span class="va">positions_visited</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use a for loop to simulate a number of turns</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">turn</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_turns</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># roll two dice</span></span>
<span>  <span class="va">die_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># move player position</span></span>
<span></span>
<span>  <span class="co"># number of positions to move</span></span>
<span>  <span class="va">plus_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">die_values</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># compute new board position</span></span>
<span>  <span class="va">new_board_position</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span> <span class="op">+</span> <span class="va">plus_move</span></span>
<span></span>
<span>  <span class="co"># if land on GO TO JAIL square, then go backwards to the JAIL square</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">new_board_position</span> <span class="op">==</span> <span class="va">go_to_jail_position</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">new_board_position</span> <span class="op">&lt;-</span> <span class="va">jail_position</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># update board position (this corrects for the fact the board is circular)</span></span>
<span>  <span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">new_board_position</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># store position visited</span></span>
<span>  <span class="va">positions_visited</span><span class="op">[</span><span class="va">turn</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<blockquote>
<p>What is the distribution of board positions during a long game?</p>
</blockquote>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">positions_visited</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, len <span class="op">=</span> <span class="fl">41</span><span class="op">)</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-markov-chains_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;"></div>
<blockquote>
<p>Can you explain this result qualitatively?</p>
</blockquote>
<p>You can also go to jail, if you roll three doubles (both dice having the same value) in a row. Update your code to allow for the possibility of going to Jail with three doubles. How does the distribution of board positions change?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_turns</span> <span class="op">&lt;-</span> <span class="fl">100000</span> <span class="co"># number of turns to take</span></span>
<span></span>
<span><span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># start on the GO space</span></span>
<span><span class="va">go_to_jail_position</span>  <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># the go to jail space</span></span>
<span><span class="va">jail_position</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># jail space</span></span>
<span></span>
<span><span class="va">move_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span><span class="va">positions_visited</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use a for loop to simulate a number of turns</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">turn</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_turns</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># set double counter to zero</span></span>
<span>  <span class="va">double_counter</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span>  <span class="co"># roll (max) three times</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co"># roll two dice</span></span>
<span>    <span class="va">die_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># if we have rolled a double for the third time, we proceed straight to jail</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">die_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="va">die_values</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">double_counter</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="va">jail_position</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># otherwise</span></span>
<span></span>
<span>    <span class="co"># move player position</span></span>
<span></span>
<span>    <span class="co"># number of positions to move</span></span>
<span>    <span class="va">plus_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">die_values</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># compute new board position</span></span>
<span>    <span class="va">new_board_position</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span> <span class="op">+</span> <span class="va">plus_move</span></span>
<span></span>
<span>    <span class="co"># if land on GO TO JAIL square, then go backwards to the JAIL square</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">new_board_position</span> <span class="op">==</span> <span class="va">go_to_jail_position</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">new_board_position</span> <span class="op">&lt;-</span> <span class="va">jail_position</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># update board position (this corrects for the fact the board is circular)</span></span>
<span>    <span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">new_board_position</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># break out of loop if we roll a non-double</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">die_values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="va">die_values</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># increment double counter</span></span>
<span>      <span class="va">double_counter</span> <span class="op">&lt;-</span> <span class="va">double_counter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># store final position visited</span></span>
<span>  <span class="va">positions_visited</span><span class="op">[</span><span class="va">turn</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span></span>
<span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">positions_visited</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, len <span class="op">=</span> <span class="fl">41</span><span class="op">)</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-markov-chains_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Adding the rolling doubles feature doesnâ€™t seem to change much. We might expect this since rolling three doubles is a very unlikely event!</p>
</div>
<div id="further-exercises" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Further Exercises<a class="anchor" aria-label="anchor" href="#further-exercises"><i class="fas fa-link"></i></a>
</h2>
<p>Now consider building a more complex Monopoly simulation by incorporating more complex aspects of the game such as:</p>
<ul>
<li>the purchase of properties</li>
<li>a ledger for each player</li>
<li>chance and community cards</li>
</ul>
<p>You will need to think carefully about the simplifying assumptions you will make to make the task achievable. Do not be over-ambitious. For example, you might initially assume that players will not build houses/hotels on properties.</p>
<p>Here are some questions to answer with your simulations:</p>
<ol style="list-style-type: decimal">
<li>How many turns does it take before all properties are purchased?</li>
<li>What are the best properties to buy?</li>
<li>How long does it take for a winner to be determined?</li>
</ol>
<p>For example, the following simple extension of the previous example adds some features to record properties being purchased. This simulation is constructed based on the assumption that a players always buys any free property that land on.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_games</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># number of games to play</span></span>
<span><span class="va">num_turns</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># number of turns to take</span></span>
<span></span>
<span><span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># start on the GO space</span></span>
<span><span class="va">go_to_jail_position</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># the go to jail space</span></span>
<span><span class="va">jail_position</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># jail space</span></span>
<span><span class="co"># vector of squares containing properties</span></span>
<span><span class="va">properties_that_can_be_bought</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">16</span>,</span>
<span>   <span class="fl">18</span>, <span class="fl">19</span>, <span class="fl">21</span>, <span class="fl">23</span>, <span class="fl">24</span>, <span class="fl">25</span>, <span class="fl">26</span>, <span class="fl">27</span>, <span class="fl">28</span>, <span class="fl">29</span>, <span class="fl">31</span>, <span class="fl">32</span>, <span class="fl">34</span>, <span class="fl">35</span>, <span class="fl">37</span>, <span class="fl">39</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># vector to store number of turns to buy all properties</span></span>
<span><span class="va">time_to_buy_all_properties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_games</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate multiple games</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">game</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_games</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">positions_visited</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span>  <span class="va">positions_purchased</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span></span>
<span>  <span class="va">properties_bought</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num_turns</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># use a for loop to simulate a number of turns</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">turn</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_turns</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># roll two dice</span></span>
<span>    <span class="va">die_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># move player position</span></span>
<span></span>
<span>    <span class="co"># number of positions to move</span></span>
<span>    <span class="va">plus_move</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">die_values</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># compute new board position</span></span>
<span>    <span class="va">new_board_position</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span> <span class="op">+</span> <span class="va">plus_move</span></span>
<span></span>
<span>    <span class="co"># if land on GO TO JAIL square, then go backwards to the JAIL square</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">new_board_position</span> <span class="op">==</span> <span class="va">go_to_jail_position</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">new_board_position</span> <span class="op">&lt;-</span> <span class="va">jail_position</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># update board position (this corrects for the fact the board is circular)</span></span>
<span>    <span class="va">current_board_position</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">new_board_position</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># if we can on a square that can be purchased and which has not been</span></span>
<span>    <span class="co"># purchased (note R uses 1-indexing for arrays)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">positions_purchased</span><span class="op">[</span><span class="va">current_board_position</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">current_board_position</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">properties_that_can_be_bought</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">positions_purchased</span><span class="op">[</span><span class="va">current_board_position</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># store position visited</span></span>
<span>    <span class="va">positions_visited</span><span class="op">[</span><span class="va">turn</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current_board_position</span></span>
<span></span>
<span>    <span class="co"># store number of properties bought</span></span>
<span>    <span class="va">properties_bought</span><span class="op">[</span><span class="va">turn</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">positions_purchased</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># check if all properties are gone</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">properties_bought</span><span class="op">[</span><span class="va">turn</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">properties_that_can_be_bought</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">time_to_buy_all_properties</span><span class="op">[</span><span class="va">game</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">turn</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">time_to_buy_all_properties</span>, breaks <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-markov-chains_files/figure-html/unnamed-chunk-12-1.png" width="80%" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="simulating-random-numbers.html"><span class="header-section-number">1</span> Simulating random numbers</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#markov-chains"><span class="header-section-number">2</span> Markov Chains</a></li>
<li><a class="nav-link" href="#model-answers-3-state-markov-chain">Model answers 3 state Markov Chain</a></li>
<li><a class="nav-link" href="#a-monopoly-simulation"><span class="header-section-number">2.1</span> A Monopoly simulation</a></li>
<li><a class="nav-link" href="#moving-around-the-board"><span class="header-section-number">2.2</span> Moving around the board</a></li>
<li><a class="nav-link" href="#going-to-jail"><span class="header-section-number">2.3</span> Going to Jail</a></li>
<li><a class="nav-link" href="#further-exercises"><span class="header-section-number">2.4</span> Further Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/anasrana/ems-practicals/blob/master/04-markov-chains.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/anasrana/ems-practicals/edit/master/04-markov-chains.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Essentials of Mathematics and Statistics</strong>" was written by Anas A Rana. It was last built on 2023-10-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
